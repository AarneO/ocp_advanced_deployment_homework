---
- name: Prepare GUID environment variable across all hosts
  hosts: all
  tasks:
    - name: All GUID env variable
      shell: export GUID=`hostname | cut -d"." -f2`; echo "export GUID=$GUID" >> $HOME/.bashrc

- name: Verify Installation and Configuration of Docker
  hosts: nodes
  tasks:
    - name: docker restart
      shell: systemctl restart docker

- name: Verify NFS Shared Volumes on Hosts
  hosts: nfs
  tasks:

- name: Install packages and config auth
  hosts: localhost
  vars_files:
    - "./env_vars.yml"
  tasks:
    - name: required packages are present
      yum:
        name: "{{ common_packages }}"
        state: present


- name: Generate Inventory Hosts File from template
  hosts: localhost
  connection: local
  become: false
  vars_files:
    - "./env_vars.yml"
  tasks:
    - name: Generate /etc/ansible/hosts file with lab hosts template
      template:
        backup: yes
        src: "./hoststempl.j2"
        dest: "/etc/ansible/hosts"


- name: Execute the openshift-ansible prerequisites
#  import_playbook:

- name: Execute the openshift-ansible Deployer
#  import_playbook: 

- name: Verify OpenShift Cluster
  hosts: masters[0]
  tasks:
    - name: copy the .kube directory from master1 to your bastion
    - fetch: 
      src= "/root/.kube/config"
      dest= "/root/.kube/config"
      flat= "yes"

- name: Post installation configuration
  hosts: localhost
  tasks:
    - name: make sure you are system:dmin
      shell: oc whoami | grep system:admin

â–½
- name: Create PVs for Users
  hosts: nfs
  tasks:
    - file:
        dest: "/srv/nfs/user-vols/pv{{ item }}"
        state: directory
      with_sequence: start=1 end=50 stride=1
    - lineinfile:
        path: /etc/exports.d/openshift-uservols.exports
        line: "/srv/nfs/user-vols/pv{{ item }} *(rw,root_squash)"
        create: yes
      with_sequence: start=1 end=50 stride=1
    - systemd:
        state: restarted
        daemon_reload: yes
        name: nfs-server
    - file:
        path: /srv/nfs
        state: directory
        owner: nfsnobody
        group: nfsnobody
        mode: 0777
        recurse: yes
~

- name: Create 25 definitions files for PVs 5G size


- name: Create 25 definitions files for PVs 10G size
  hosts: nfs
   - file:
     dest: "/srv/nfs/user-vols/pv{{ item }}"
     state: directory
     with_sequence: start=26 end=50 stride=1

- name: Create all PVs from definitions files

- name: Fix NFS Persistent Volume Recycling

- name: Smoke Test

- name: Jenkins Setup
  hosts: localhost
  tasks:
    - name: jenkins setup
      script: ???

- name: HPA configuration on production deployment of openshift-tasks
  hosts: localhost
  tasks:

- name: Creation of users for Alpha and Beta clients

- name: Assigning labels to the users according to its group

- name: Setup the environment for Alpha and Beta clients